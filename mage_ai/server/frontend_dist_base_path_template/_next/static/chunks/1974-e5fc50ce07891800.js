"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1974],{94629:function(e,r,n){n.d(r,{Z:function(){return g}});var t=n(82394),o=n(21831),i=n(82684),u=n(50724),s=n(82555),l=n(97618),a=n(70613),c=n(92272),d=n(68899),f=n(28598);function p(e,r){var n=e.children,t=e.noPadding;return(0,f.jsx)(d.HS,{noPadding:t,ref:r,children:n})}var h=i.forwardRef(p),b=n(62547),m=n(82571),v=n(77417),w=n(46684),O=n(75375);function y(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function j(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?y(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function Z(e,r){e.addProjectBreadcrumbToCustomBreadcrumbs;var n=e.after,t=e.afterHeader,i=e.afterHidden,p=e.afterWidth,y=e.afterWidthOverride,Z=e.appendBreadcrumbs,g=e.before,P=e.beforeHeader,S=e.beforeWidth,x=e.breadcrumbs,E=e.children,C=e.contained,I=e.errors,_=e.headerMenuItems,k=e.headerOffset,A=e.hideAfterCompletely,R=e.mainContainerHeader,W=e.navigationItems,M=e.setAfterHidden,D=e.setAfterWidth,B=e.setBeforeWidth,T=e.setErrors,H=e.subheaderChildren,N=e.subheaderNoPadding,U=e.title,F=e.uuid,L=(0,O.Z)(F,{beforeResizeOffset:O.H,setWidthAfter:D,setWidthBefore:B,widthAfter:p,widthBefore:S,widthOverrideAfter:y}),q=L.mainContainerRef,G=L.mousedownActiveAfter,V=L.mousedownActiveBefore,z=L.setMousedownActiveAfter,K=L.setMousedownActiveBefore,Q=L.setWidthAfter,Y=L.setWidthBefore,J=L.widthAfter,X=L.widthBefore,$=(0,v.Z)().project,ee=[];return x&&ee.push.apply(ee,(0,o.Z)(x)),null!=x&&x.length&&!Z||!$||null!=x&&x.length||ee.unshift({bold:!Z,label:function(){return U}}),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(a.Z,{title:U}),(0,f.jsx)(c.Z,{breadcrumbs:ee,menuItems:_}),(0,f.jsxs)(d.Nk,{ref:r,children:[0!==(null==W?void 0:W.length)&&(0,f.jsx)(d.lm,{showMore:!0,children:(0,f.jsx)(m.Z,{navigationItems:W,showMore:!0})}),(0,f.jsx)(l.Z,{flex:1,flexDirection:"column",children:(0,f.jsxs)(b.Z,{after:n,afterHeader:t,afterHeightOffset:w.Mz,afterHidden:i,afterMousedownActive:G,afterWidth:J,before:g,beforeHeader:P,beforeHeightOffset:w.Mz,beforeMousedownActive:V,beforeWidth:g?X:d.k1,contained:C,headerOffset:k,hideAfterCompletely:!n||A,leftOffset:g?d.k1:null,mainContainerHeader:R,mainContainerRef:q,setAfterHidden:M,setAfterMousedownActive:z,setAfterWidth:Q,setBeforeMousedownActive:K,setBeforeWidth:Y,children:[H&&(0,f.jsx)(h,{noPadding:N,children:H}),E]})})]}),I&&(0,f.jsx)(u.Z,{disableClickOutside:!0,isOpen:!0,onClickOutside:function(){return null==T?void 0:T(null)},children:(0,f.jsx)(s.Z,j(j({},I),{},{onClose:function(){return null==T?void 0:T(null)}}))})]})}var g=i.forwardRef(Z)},93808:function(e,r,n){n.d(r,{Z:function(){return E}});var t=n(77837),o=n(26304),i=n(62243),u=n(29385),s=n(80022),l=n(13692),a=n(93189),c=n(15544),d=n(82394),f=n(38860),p=n.n(f),h=n(82684),b=n(56663),m=n.n(b),v=n(40761),w=n(34661),O=n(36105),y=n(50178),j=n(69419),Z=n(28598),g=["auth"];function P(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function S(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?P(Object(n),!0).forEach((function(r){(0,d.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function x(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,t=(0,c.Z)(e);if(r){var o=(0,c.Z)(this).constructor;n=Reflect.construct(t,arguments,o)}else n=t.apply(this,arguments);return(0,a.Z)(this,n)}}function E(e){return function(r){(0,l.Z)(c,r);var n,a=x(c);function c(){var e;(0,i.Z)(this,c);for(var r=arguments.length,n=new Array(r),t=0;t<r;t++)n[t]=arguments[t];return e=a.call.apply(a,[this].concat(n)),(0,d.Z)((0,s.Z)(e),"state",{auth:new v.Z(e.props.token)}),e}return(0,u.Z)(c,[{key:"componentDidMount",value:function(){this.setState({auth:new v.Z(this.props.token)})}},{key:"render",value:function(){var r=this.props,n=(r.auth,(0,o.Z)(r,g));return(0,Z.jsx)(e,S({auth:this.state.auth},n))}}],[{key:"getInitialProps",value:(n=(0,t.Z)(p().mark((function r(n){var t,o,i,u,s,l,a,c,d;return p().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=m()(n),o=(0,y.ex)(n),i=o.id,u=t[w.Mv],s=t[O.qt],l=new v.Z(u),a=S(S({},n),{},{auth:l,currentGroupId:i,theme:s}),(0,y.YB)(n)&&l.isExpired&&(console.log("OAuth token has expired."),c=S(S({},n.query),{},{redirect_url:n.asPath}),(0,j.nL)("/sign-in?".concat((0,j.uM)(c)),n.res)),!e.getInitialProps){r.next=12;break}return r.next=10,e.getInitialProps(a);case 10:return d=r.sent,r.abrupt("return",S(S({},d),{},{auth:l,currentGroupId:i,theme:s}));case 12:return r.abrupt("return",a);case 13:case"end":return r.stop()}}),r)}))),function(e){return n.apply(this,arguments)})}]),c}(h.Component)}},14875:function(e,r,n){n.d(r,{Z3:function(){return t},ms:function(){return i},s7:function(){return o}});var t=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],o="password_current",i=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:o},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},36043:function(e,r,n){var t=n(82394),o=n(21831),i=n(75582),u=n(21764),s=n(82684),l=n(83455),a=n(71180),c=n(31882),d=n(55485),f=n(85854),p=n(44085),h=n(38276),b=n(30160),m=n(17488),v=n(35686),w=n(50018),O=n(98464),y=n(82359),j=n(14875),Z=n(86735),g=n(42122),P=n(72619),S=n(28598);function x(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function E(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?x(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}r.Z=function(e){var r=e.disabledFields,n=e.hideFields,x=e.newUser,C=e.onDeleteSuccess,I=e.onSaveSuccess,_=e.showDelete,k=e.title,A=e.user,R=(0,s.useState)(!0),W=R[0],M=R[1],D=(0,s.useState)({}),B=D[0],T=D[1],H=(0,s.useState)(null),N=H[0],U=H[1],F=((0,w.Z)()||{}).owner,L=v.ZP.statuses.list().data,q=(0,s.useMemo)((function(){var e;return(null==L||null===(e=L.statuses)||void 0===e?void 0:e[0])||{}}),[L]),G=q.project_type,V=q.project_uuid,z="global",K=null,Q=null;G===y.k.SUB?(z="project",K=V):G===y.k.MAIN&&(Q="The roles selected here will apply to this user globally.\n                If a user has both a global role and a workspace role,\n                then the role with higher access will take precedence.");var Y=v.ZP.roles.list({entity:z,entity_ids:K?[K]:[],limit_roles:!!x},{revalidateOnFocus:!1}),J=Y.data,X=(Y.mutate,(0,s.useMemo)((function(){return(null==J?void 0:J.roles)||[]}),[null==J?void 0:J.roles])),$=(0,l.Db)(x?v.ZP.users.useCreate():v.ZP.users.useUpdate(null==A?void 0:A.id),{onSuccess:function(e){return(0,P.wD)(e,{callback:function(e){var r=e.user,n=j.Z3.concat(j.ms).map((function(e){return e.uuid}));n.push("id");var t=(0,g.GL)(r,n);U(t),u.Am.success(x?"New user created successfully.":"User profile successfully updated.",{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(r.id)}),null==I||I(t)},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.exception,o=r.message,i=r.type;u.Am.error((null==n?void 0:n.error)||t||o,{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:i})}})}}),ee=(0,i.Z)($,2),re=ee[0],ne=ee[1].isLoading,te=(0,l.Db)(v.ZP.users.useDelete(null==A?void 0:A.id),{onSuccess:function(e){return(0,P.wD)(e,{callback:function(){null==C||C()},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.message;alert(t),console.log(n)}})}}),oe=(0,i.Z)(te,2),ie=oe[0],ue=oe[1].isLoading,se=n?(0,o.Z)(n):[];x&&se.push(j.s7);var le=!se||!se.includes(j.s7),ae=(0,O.Z)(A);(0,s.useEffect)((function(){if(A&&(!N||(null==ae?void 0:ae.id)!==(null==A?void 0:A.id))){var e=j.Z3.concat(j.ms).map((function(e){return e.uuid}));U((0,g.GL)(A,e))}null!=N&&N.password||null!=N&&N.password_confirmation?(null==N?void 0:N.password)!==(null==N?void 0:N.password_confirmation)?T({password_confirmation:"Password confirmation does not match."}):!le||null!=N&&N.password_current?T(null):T({password_current:"This field is required."}):null!=N&&N.password_current&&le?null!=N&&N.password&&null!=N&&N.password_confirmation?T(null):T({password:"This field is required.",password_confirmation:"This field is required."}):null!=N&&N.password_current||null!=N&&N.password||null!=N&&N.password_confirmation||T(null)}),[N,le,A,ae]);var ce=(0,s.useState)(!1),de=ce[0],fe=ce[1],pe=(0,s.useMemo)((function(){return(de?null==N?void 0:N.roles_new:null==A?void 0:A.roles_new)||[]}),[N,de,A]),he=(0,s.useMemo)((function(){var e=(null==X?void 0:X.map((function(e){return e.id})))||[];return null==pe?void 0:pe.filter((function(r){var n=r.id;return e.includes(n)}))}),[pe,X]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(f.Z,{children:k||"Edit profile"}),(0,S.jsxs)("form",{children:[j.Z3.filter((function(e){var r=e.uuid;return!se||!se.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,o=e.label,i=e.required,u=e.type,s=e.uuid;return(0,S.jsx)(h.Z,{mt:2,children:(0,S.jsx)(m.Z,{autoComplete:r,disabled:n&&!x,label:o,onChange:function(e){M(!1),U((function(r){return E(E({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:i,setContentOnMount:!0,type:u,value:(null==N?void 0:N[s])||""})},s)})),!(null!=A&&A.owner)&&!(null!=se&&se.includes("roles"))&&(0,S.jsxs)(h.Z,{mt:2,children:[Q&&(0,S.jsx)(h.Z,{mb:1,children:(0,S.jsx)(b.ZP,{children:Q})}),(0,S.jsx)(p.Z,{disabled:null==r?void 0:r.includes("roles"),label:"Roles",onChange:function(e){var r=(0,Z.sE)(X,(function(r){return r.id==e.target.value}));r&&(M(!1),fe(!0),U((function(e){var n={};return(0,Z.sE)(pe,(function(e){return e.id==(null==r?void 0:r.id)}))||(n={roles_new:[].concat((0,o.Z)(pe),[r])}),E(E({},e),n)})))},primary:!0,setContentOnMount:!0,children:X.map((function(e){var r=e.id,n=e.name;return(0,S.jsx)("option",{value:r,children:n},n)}))}),(0,S.jsx)(h.Z,{mb:1}),(0,S.jsx)(d.ZP,{alignItems:"center",flexWrap:"wrap",children:null==he?void 0:he.map((function(e){var n=e.id,t=e.name;return(0,S.jsx)(h.Z,{mb:1,mr:1,children:(0,S.jsx)(c.Z,{disabled:null==r?void 0:r.includes("roles"),label:t,onClick:function(){M(!1),fe(!0),U((function(e){return E(E({},e),{},{roles_new:(0,Z.Od)(pe,(function(e){return e.id===n}))})}))},primary:!0})},"user_roles/".concat(t))}))})]}),(0,S.jsxs)(h.Z,{mt:5,children:[(0,S.jsx)(f.Z,{children:x?"Password":"Change password"}),j.ms.filter((function(e){var r=e.uuid;return!se||!se.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,o=e.label,i=e.required,u=e.type,s=e.uuid;return(0,S.jsx)(h.Z,{mt:2,children:(0,S.jsx)(m.Z,{autoComplete:r,disabled:n,label:o,meta:{error:null==B?void 0:B[s],touched:!(null==B||!B[s])},onChange:function(e){M(!1),U((function(r){return E(E({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:i,setContentOnMount:!0,type:u,value:(null==N?void 0:N[s])||""})},s)}))]}),(0,S.jsx)(h.Z,{mt:5,children:(0,S.jsxs)(d.ZP,{children:[(0,S.jsx)(a.ZP,{disabled:W||B&&!(0,g.Qr)(B),loading:ne,onClick:function(){var e,r=E({},N);"roles_new"in r&&(r.roles_new=null===(e=N.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));re({user:r})},primary:!0,children:x?"Create new user":"Update user profile"}),_&&F&&(0,S.jsx)(h.Z,{ml:1,children:(0,S.jsx)(a.ZP,{danger:!0,loading:ue,onClick:function(){window.confirm("Are you sure you want to delete ".concat(N.username||N.email,"?"))&&ie()},children:"Delete user"})})]})})]})]})}},75083:function(e,r,n){n.d(r,{HF:function(){return i},L6:function(){return t}});var t,o=n(72473);function i(e,r,n){var i=e.owner,u=(e.roles,[{Icon:o.WorkspacesIcon,id:t.WORKSPACES,isSelected:function(){return t.WORKSPACES===n},label:function(){return"Workspaces"},linkProps:{href:"/manage"}},{Icon:o.NavDashboard,id:t.OVERVIEW,isSelected:function(){return t.OVERVIEW===n},label:function(){return"Overview"},linkProps:{href:"/manage/overview"}},{Icon:o.Schedule,id:t.PIPELINE_RUNS,isSelected:function(){return t.PIPELINE_RUNS===n},label:function(){return"Pipeline runs"},linkProps:{href:"/manage/pipeline-runs"}}]);return i&&u.push({Icon:o.WorkspacesUsersIcon,id:t.USERS,isSelected:function(){return t.USERS===n},label:function(){return"Users"},linkProps:{href:"/manage/users"}}),u.push.apply(u,[{Icon:o.File,id:t.FILE_BROWSER,isSelected:function(){return t.FILE_BROWSER===n},label:function(){return"File browser"},linkProps:{href:"/manage/files"}},{Icon:o.Settings,id:t.SETTINGS,isSelected:function(){return t.SETTINGS===n},label:function(){return"Settings"},linkProps:{href:"/manage/settings"}}]),u}!function(e){e.OVERVIEW="overview",e.PIPELINE_RUNS="pipeline_runs",e.WORKSPACES="workspaces",e.USERS="users",e.SETTINGS="settings",e.FILE_BROWSER="file_browser"}(t||(t={}))},59533:function(e,r,n){var t=n(82684),o=n(94629),i=n(35686),u=n(50018),s=n(70515),l=n(75083),a=n(28598);r.Z=function(e){var r=e.before,n=e.breadcrumbs,c=void 0===n?[]:n,d=e.children,f=e.errors,p=e.headerOffset,h=e.mainContainerHeader,b=e.pageName,m=e.setErrors,v=e.subheaderChildren,w=i.ZP.statuses.list().data,O=(0,t.useMemo)((function(){var e,r;return null==w||null===(e=w.statuses)||void 0===e||null===(r=e[0])||void 0===r?void 0:r.project_type}),[w]),y=(0,u.Z)()||{};return(0,a.jsx)(o.Z,{before:r,beforeWidth:r?50*s.iI:0,breadcrumbs:c,errors:f,headerOffset:p,mainContainerHeader:h,navigationItems:(0,l.HF)(y,O,b),setErrors:m,subheaderChildren:v,title:"Workspaces",uuid:"workspaces/index",children:d})}},80022:function(e,r,n){function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(r,{Z:function(){return t}})},15544:function(e,r,n){function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(e)}n.d(r,{Z:function(){return t}})},13692:function(e,r,n){n.d(r,{Z:function(){return o}});var t=n(61049);function o(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&(0,t.Z)(e,r)}},93189:function(e,r,n){n.d(r,{Z:function(){return i}});var t=n(12539),o=n(80022);function i(e,r){if(r&&("object"===t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return(0,o.Z)(e)}}}]);